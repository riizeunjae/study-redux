<!DOCTYPE html>
<html>
  <head>
    <title>리덕스 - TODO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.6.0/redux.js"></script>
  </head>
  <body>
    <h3>오늘 할 일</h3>
    <ul id="todo-list"></ul>

    <div>
      <input id="input-text" />
      <button id="add-button">할 일 추가</button>
      <button id="remove-button">할 일 삭제</button>
      <button id="remove-all-button">모두 삭제</button>
      <button id="logging-state">State Logging</button>
    </div>

    <h3>메모</h3>
    <ul id="memo-list"></ul>

    <div>
      <input id="input-memo-text" />
      <button id="add-memo-button">메모 추가</button>
      <button id="remove-memo-button">메모 삭제</button>
    </div>

    <script>
      // TODO 관련 Action Type
      let ACTION_TYPE_ADD_TODO = "ADD_TODO";
      let ACTION_TYPE_REMOVE_TODO = "REMOVE_TODO";
      let ACTION_TYPE_REMOVE_ALL = "REMOVE ALL";
      // MEMO 관련 Action Type
      let ACTION_TYPE_ADD_MEMO = "ADD_MEMO";
      let ACTION_TYPE_REMOVE_MEMO = "REMOVE_MEMO";

      let todoInitialState = [];
      let memoInitialState = [];
      //  reducer는 무조건 state를 return해야 하기 때문에 초기값을 설정해 준다.

      function todoReducer(state = todoInitialState, action) {
        switch (action.type) {
          case ACTION_TYPE_ADD_TODO:
            return state.concat(action.text);
          case ACTION_TYPE_REMOVE_TODO:
            return state.slice(0, -1);
          case ACTION_TYPE_REMOVE_ALL:
            return [];
          default:
            return state;
        }
      }

      function memoReducer(state = memoInitialState, action) {
        switch (action.type) {
          case ACTION_TYPE_ADD_MEMO:
            return state.concat(action.text);
          case ACTION_TYPE_REMOVE_MEMO:
            return state.slice(0, -1);
          default:
            return state;
        }
      }

      function loggerMiddleware({ getState }) {
      function loggerMiddleware({getState}){
        return (next) => (action) => {
          console.log("dispatch 예정 action", action);

          // Middleware chain에 있는 다음 dispatch 함수를 호출
          const returnValue = next(action);

          console.log("dispatch 이후 state", getState());

          return returnValue;
        };
      }

      // key값 기준으로 root state 만들어진다
      let rootReducer = Redux.combineReducers({
        todo: todoReducer,
        memmo: memoReducer,
      });

      // Store 선언
      let store = Redux.createStore(
        rootReducer,
        Redux.applyMiddleware(loggerMiddleware)
      );

          const returnValue = next(action)

          console.log("dispatch 이후 state", getState());

          return returnValue
        }
      }

      let store = Redux.createStore(todoReducer, ["리덕스 공부하기"]);
      let todoListElem = document.getElementById("todo-list");
      let memoListElem = document.getElementById("memo-list");
      let inputElem = document.getElementById("input-text");
      let inputMemoElem = document.getElementById("input-memo-text");

      function render() {
        // 이전 TODO, MEMO 목록 초기화
        todoListElem.innerHTML = "";
        memoListElem.innerHTML = "";

        // TODO 목록 렌더링 // key값인 .todo로 접근
        store.getState().todo.forEach((todo) => {
          const todoListItemElem = document.createElement("li");
          todoListItemElem.textContent = todo;
          todoListElem.appendChild(todoListItemElem);
        });

        // MEMO 목록 렌더링 // key값인 .memo로 접근
        store.getState().memo.forEach((memo) => {
          const memoListItemElem = document.createElement("li");
          memoListItemElem.textContent = memo;
          memoListElem.appendChild(memoListItemElem);
        });
      }


      // Redux store의 상태가 변경될 때마다 render 함수를 호출하여 화면을 업데이트
      // Redux의 상태를 이용하여 화면에 데이터를 동적으로 표시하고, 상태의 변화에 따라 화면을 업데이트하는 핵심적인 역할을 수행
      render();
      store.subscribe(render);

      // action object 만들기
      function addTodoActionCreator(text) {
        return {
          type: ACTION_TYPE_ADD_TODO,
          text: text,
        };
      }

      function removeTodoActionCreator() {
        return {
          type: ACTION_TYPE_REMOVE_TODO,
        };
      }

      function removeAllActionCreator() {
        return {
          type: ACTION_TYPE_REMOVE_ALL,
        };
      }

      function addMemoActionCreator(text) {
        return {
          type: ACTION_TYPE_ADD_MEMO,
          text: text,
        };
      }

      function removeMemoActionCreator() {
        return {
          type: ACTION_TYPE_REMOVE_MEMO,
        };
      }

      document
        .getElementById("add-button")
        .addEventListener("click", function () {
          // Action을 실제로 dispatch
          store.dispatch(addTodoActionCreator(inputElem.value));
          // Input 초기화
          inputElem.value = "";
        });

      document
        .getElementById("remove-button")
        .addEventListener("click", function () {
          store.dispatch(removeTodoActionCreator());
        });

      document
        .getElementById("remove-all-button")
        .addEventListener("click", function () {
          sotre.dispatch(removeAllActionCreator());
        });

      document
        .getElementById("add-memo-button")
        .addEventListener("click", function () {
          store.dispatch(addMemoActionCreator(inputMemoElem.value));
        });

      document
        .getElementById("remove-memo-button")
        .addEventListener("click", function () {
          store.dispatch(removeMemoActionCreator());
        });
        // log button에 event listener 추가
        document.getElementById("logging-state")
        .addEventListener("click", function() {
          console.log("현재 state", store.getState())
        })
    </script>
  </body>
</html>

<!-- Redux Action 객체 -> Javascript 함수
type, text 등의 프로퍼티  Action :
애플리케이션에서 발생하는 일들을 설명하는 JavaScript객체
Action creator:
Action 객체를 생성하는 역할을 하는 Javascript 함수 -->

<!-- function addTodo(text) {
  return { type: "ADD_TODO", text: text };
} -->
