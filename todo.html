<!DOCTYPE html>
<html>
  <head>
    <title>리덕스 - TODO</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/redux/3.6.0/redux.js"></script>
  </head>
  <body>
    <h3>오늘 할 일</h3>
    <ul id="todo-list"></ul>

    <div>
      <input id="input-text" />
      <button id="add-button">할 일 추가</button>
      <button id="logging-state">State Logging</button>
    </div>
    <script>
      function todoReducer(state, action) {
        switch (action.type) {
          case "ADD_TODO":
            return state.concat(action.text);
          default:
            return state;
        }
      }

      function loggerMiddleware({getState}){
        return (next) => (action) => {
          console.log("dispatch 예정 action", action);

          // Middleware chain에 있는 다음 dispatch 함수를 호출
          const returnValue = next(action)

          console.log("dispatch 이후 state", getState());

          return returnValue
        }
      }

      let store = Redux.createStore(todoReducer, ["리덕스 공부하기"]);
      let todoListElem = document.getElementById("todo-list");
      let inputElem = document.getElementById("input-text");

      function render() {
        // 이전 TODO 목록 초기화
        todoListElem.innerHTML = "";

        // TODO 목록 렌더링
        store.getState().forEach((todo) => {
          const todoListItemElem = document.createElement("li");
          todoListItemElem.textContent = todo;
          todoListElem.appendChild(todoListItemElem);
        });
      }


      // Redux store의 상태가 변경될 때마다 render 함수를 호출하여 화면을 업데이트
      // Redux의 상태를 이용하여 화면에 데이터를 동적으로 표시하고, 상태의 변화에 따라 화면을 업데이트하는 핵심적인 역할을 수행
      render();
      store.subscribe(render);

      document
        .getElementById("add-button")
        .addEventListener("click", function () {
          // Action을 실제로 dispatch
          store.dispatch({
            type: "ADD_TODO",
            text: inputElem.value,
          });

          // Input 초기화
          inputElem.value = "";
        });

        // log button에 event listener 추가
        document.getElementById("logging-state")
        .addEventListener("click", function() {
          console.log("현재 state", store.getState())
        })
    </script>
  </body>
</html>
